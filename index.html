<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"> 
    <title>Cosmic Rising</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    
    <script src="box2d.min.js" type="text/jscript"></script>
    <script src="box2d-helpers.js" type="text/javascript"></script>
    
    <script src="utils.js"></script>
    <script src="camera.js"></script>
    <script src="init.js"></script>
    
    <script src="animation.js"></script>
    <script src="obstacle.js"></script>
    <script src="level.js"></script>
    <script src="debris.js"></script>
    <script src="bullet.js"></script>
    <script src="ship.js"></script>
    <script src="main.js"></script>
    <script src="menu.js"></script>
    <script src="enemy-spawn-point.js"></script>
    <script src="level.js"></script>
    <script src="input2.js"></script>
    <script src="game-ai.js"></script>

</head>
    <body>
        
        <script>
            window.requestAnimationFunc = (function(){
                if (window.requestAnimationFrame) {
                    return window.requestAnimationFrame;
                }
                if (window.webkitRequestAnimationFrame) {
                    return window.webkitRequestAnimationFrame;
                }
                if (window.mozRequestAnimationFrame) {
                    window.mozRequestAnimationFrame;
                }
                if (window.oRequestAnimationFrame) {
                    window.oRequestAnimationFrame;
                }
                if (window.msRequestAnimationFrame) {
                    window.msRequestAnimationFrame;
                }
                return function(callback){
                    window.setTimeout(callback, 1000/60);
                };      
            })();
            
            InitGame();
            loadAssets();
            


            function start() {
                listener = new JSContactListener();
                listener.BeginContact = function (contactPtr) {
                    var contact = Box2D.wrapPointer(contactPtr, b2Contact);
                    if (contact.IsTouching()) {
                        var a = contact.GetFixtureA().GetBody().actor;
                        var b = contact.GetFixtureB().GetBody().actor;
                        if (contact.GetFixtureA().IsSensor() && !contact.GetFixtureB().IsSensor()) {
                            if (a.beginSensorCallback)
                                a.beginSensorCallback(b);
                        }
                        else if (contact.GetFixtureB().IsSensor() && !contact.GetFixtureA().IsSensor()) {
                            if (b.beginSensorCallback)
                                b.beginSensorCallback(b);
                        }
                        else if (!contact.GetFixtureA().IsSensor() && !contact.GetFixtureB().IsSensor()) {
                            if(a.beginContactCallback) {
                                a.beginContactCallback(b);
                            }
                            if(b.beginContactCallback) {
                                b.beginContactCallback(a);
                            }
                        }
                    }
                }
                listener.EndContact = function(contactPtr) {
                    var contact = Box2D.wrapPointer(contactPtr, b2Contact);
                    if (contact.IsTouching()) {
                        var a = contact.GetFixtureA().GetBody().actor;
                        var b = contact.GetFixtureB().GetBody().actor;
                        if (contact.GetFixtureA().IsSensor() && !contact.GetFixtureB().IsSensor()) {
                            if (a.endSensorCallback)
                                a.endSensorCallback(b);
                        }
                        else if (contact.GetFixtureB().IsSensor() && !contact.GetFixtureA().IsSensor()) {
                            if (b.endSensorCallback)
                                b.endSensorCallback(b);
                        }
                        else if (!contact.GetFixtureA().IsSensor() && !contact.GetFixtureB().IsSensor()) {
                            if(a.endContactCallback) {
                                a.endContactCallback(b);
                            }
                            if(b.beginContactCallback) {
                                b.endContactCallback(a);
                            }
                        }
                    }
                };
                listener.PreSolve = function() {};
                listener.PostSolve = function() {};
                app.world.SetContactListener(listener);
                
                app.level = new Level(150, 150);
                
                switchMusicToMenu();
                
                if (app.iOS) {
                    window.setInterval(main_iOS, 1000/60);
                }
                else{
                    window.requestAnimationFunc(main);
                }
                
            }
        </script>

    </body>
</html>
