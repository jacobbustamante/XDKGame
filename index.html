<!DOCTYPE html>
<html>
<head>
    <title>Cosmic ...</title>
    <link rel="stylesheet" type="text/css" href="main.css">
    
    <script src="box2d.min.js" type="text/jscript"></script>
    <script src="box2d-helpers.js" type="text/javascript"></script>
    
    <script src="utils.js"></script>
    <script src="camera.js"></script>
    <script src="init.js"></script>
    
    <script src="animation.js"></script>
    <script src="level.js"></script>
    <script src="bullet.js"></script>
    <script src="ship.js"></script>
    <script src="main.js"></script>
    
    <script src="input.js"></script>

</head>
    <body>
        
        <script>
            window.requestAnimationFunc = (function(){
                if (window.requestAnimationFrame) {
                    return window.requestAnimationFrame;
                }
                if (window.webkitRequestAnimationFrame) {
                    return window.webkitRequestAnimationFrame;
                }
                if (window.mozRequestAnimationFrame) {
                    window.mozRequestAnimationFrame;
                }
                if (window.oRequestAnimationFrame) {
                    window.oRequestAnimationFrame;
                }
                if (window.msRequestAnimationFrame) {
                    window.msRequestAnimationFrame;
                }
                return function(callback){
                    window.setTimeout(callback, 1000/60);
                };      
            })();
            InitGame();
            loadAssets();
            
            var speed = 20;
            
            window.addEventListener("keydown", moveShip);
            function moveShip(e) {
                //e.preventDefault();
                switch(e.which) {
                    case 87: // w
                        app.player.vy = speed;
                        break;
                    case 83: // s
                        app.player.vy = -speed;
                        break;
                    case 65: // a
                        app.player.vx = -speed;
                        break;
                    case 68: // d
                        app.player.vx = speed;
                        break;
                    default:
                        break;
                }
            }
            window.addEventListener("keyup", stopShip);
            function stopShip(e) {
                //e.preventDefault();
                switch(e.which) {
                    case 87: // w
                        app.player.vy = 0;
                        break;
                    case 83: // s
                        app.player.vy = 0;
                        break;
                    case 65: // a
                        app.player.vx = 0;
                        break;
                    case 68: // d
                        app.player.vx = 0;
                        break;
                    default:
                        break;
                }
            }
            
            document.addEventListener("mousewheel", zoomCamera, false);
            function zoomCamera(e) {
                if (e.wheelDelta > 0) {
                    app.camera.PixelsToMeters = (app.camera.PixelsToMeters/1.15);
                }
                else {
                    app.camera.PixelsToMeters = (app.camera.PixelsToMeters*1.15);
                }
            }
            
            document.body.addEventListener("touchstart", onTap);
            function onTap(e) {
                e.preventDefault();
                var g = app.ctx;
                for(var i = 0, len = e.touches.length; i < len; ++i) {
                    var t = e.touches[i];
                    var x = t.clientX;
                    var y = t.clientY;
                    v//ar str = "(" + x + "," + y + ")";
                    //g.fillText(str, x, y);
                    if (e.x <=(app.canvas.width / 2))
                        player.x -= 25;
                    else
                        player.x += 25;
                }
            }

            function start() {
                Object.defineProperty(app, "camera", {
                    value: new Camera(),
                    enumerable: true,
                    writable: true,
                    configurable: false
                });
                var lev = new Level();
                lev.createNewLevel();
                
                var sound = new Audio("asset/FirstShipLoop.wav");
                sound.loop = true;
                sound.volume = 0.25;
                sound.load();
                sound.play();
                app.player = new PlasmaShip(0, 0);
                
                if (app.iOS) {
                    window.setInterval(main_iOS, 1000/60);
                }
                else{
                    window.requestAnimationFunc(main);
                }
                
            }
        </script>

    </body>
</html>
